doctype html
html
  head
    title= title
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')

    link(href='https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap', rel='stylesheet')
    link(
      rel="stylesheet", 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", 
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH", 
      crossorigin="anonymous"
    )
    link(rel='stylesheet', href='/css/styles.css')

    script(src='/js/main.js')
    script(
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js", 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz", 
      crossorigin="anonymous"
    )
  
  body
    // Render navbar only if the user is logged in (either as a guest or a registered user)
    if user
      block navbar
        nav.navbar.navbar-expand-lg.bg-body-tertiary
          div.container-fluid.d-flex.align-items-center
            // Left Section: EcoTrack and links
            div.d-flex.align-items-center.flex-grow-1
              a.navbar-brand.me-3(href="/") EcoTrack
              ul.navbar-nav.d-flex.flex-row
                li.nav-item
                  a.nav-link(href="/") Home
                li.nav-item
                  a.nav-link(href="/about") About
                li.nav-item
                  a.nav-link(href="/news") News
                li.nav-item
                  a.nav-link(href="/history") History
                if user.role == "admin"
                  li.nav-item
                    a.nav-link(href="/dashboard") Admin Dashboard

            // Right Section: Login/Logout and Username
            if user.role === 'guest'
              img#userIcon(src="/images/profile-user.png", alt="User_Icon")
              span.navbar-text.text-white.userEmail Guest
              a.btn.btn-light.ms-auto.loginBtn(href="/login", id="SignInButton") SignIn
            else if user.role === 'admin'
              img#userIcon(src="/images/profile-user.png", alt="User_Icon")
              span.navbar-text.text-white.userEmail Admin
              a.btn.btn-light.ms-auto.loginBtn(href="/login", id="logoutButton") Logout
            else
              img#userImg(src=(user.avatar), alt="User_Icon")
              span.navbar-text.text-white.userEmail #{user.name}
              a.btn.btn-light.logoutBtn(type="button", id="logoutButton") Logout

    block content

    script.
      document.getElementById('logoutButton')?.addEventListener('click', async () => {
        try {
          const response = await fetch('/logout', { method: 'GET' });
          if (response.ok) {
            alert('Logged out successfully!');
            window.location.reload();
          } else {
            alert('Failed to log out. Please try again.');
          }
        } catch (error) {
          console.error('Error during logout:', error);
          alert('An error occurred. Please try again later.');
        }
      });
      document.getElementById('SignInButton')?.addEventListener('click', async () => {
        try {
          const response = await fetch('/logout', { method: 'GET' });
          if (response.ok) {
            alert('Please Register to Continue!');
            window.location.href = '/register';
          } else {
            alert('Failed to process your request. Please try again later.');
          }
        } catch (error) {
          console.error('Error during processing your request:', error);
          alert('An error occurred. Please try again later.');
        }
      });